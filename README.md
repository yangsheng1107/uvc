fork from https://gist.github.com/maxlapshin/1253534
